"0","# Count the number of corals for each tile (ALL CORALS)"
"0","coral.2016 <- coral_2016 %>%"
"0","  mutate(Convert = ifelse(Polyp.. %in% NA, NA, ""1"")) %>% "
"0","  # convert all the numbers to 1 so you can sum them"
"0","  group_by(Year, Location, Depth, Treatment, Pair, Tile.number, Original.Tile.Number, New.Tile.Number) %>%"
"0","  dplyr::summarize(All.corals = sum(!is.na(Convert))) %>% "
"0","  # don't count the NAs (they go to 0)"
"0","  arrange(as.numeric(New.Tile.Number)) %>%"
"0","  ungroup()"
"1","`summarise()` has grouped output by 'Year', 'Location', 'Depth', 'Treatment', 'Pair', 'Tile.number', 'Original.Tile.Number'. You can override using the `.groups` argument.
"
"0","# 138 tiles"
"0","# looks good (8Feb2022)"
"0",""
"0",""
"0","# Divots vs edge, etc."
"0","coral.divots_2016 <- coral_2014.2016_clean_metadata %>%"
"0","  filter(Year == ""2016"") %>%"
"0","    mutate(Substrate..Flat..edge..divot.= "
"0","           dplyr::recode(Substrate..Flat..edge..divot., ""divot "" = ""divot"", "
"0","                  .default = Substrate..Flat..edge..divot.)) %>% "
"0","  # fix naming issue"
"0","      mutate(Substrate..Flat..edge..divot.= "
"0","           dplyr::recode(Substrate..Flat..edge..divot., ""edge/flat"" = ""flat/edge"", "
"0","                  .default = Substrate..Flat..edge..divot.)) %>% "
"0","  # fix naming issue"
"0","    mutate(Convert = ifelse(Polyp.. %in% NA, NA, ""1"")) %>% "
"0","  # convert all the numbers to 1 so you can sum them"
"0","  group_by(Year, Location, Depth, Treatment, Tile.number, Original.Tile.Number, Pair,"
"0","           New.Tile.Number, Substrate..Flat..edge..divot.) %>%"
"0","  dplyr::summarize(Corals = sum(!is.na(Convert))) %>% "
"0","  # count up all the corals in divot vs flat, etc"
"0","  arrange(as.numeric(New.Tile.Number)) %>%"
"0","  ungroup() %>%"
"0","   pivot_wider(names_from = Substrate..Flat..edge..divot., "
"0","               values_from = Corals) %>% "
"0","  # wide so you can get zeros for the not counted"
"0","   dplyr::select(-""NA"") %>% "
"0","  # get rid of the NA column"
"0","   mutate_all(funs(replace_na(.,0))) "
"1","`summarise()` has grouped output by 'Year', 'Location', 'Depth', 'Treatment', 'Tile.number', 'Original.Tile.Number', 'Pair', 'New.Tile.Number'. You can override using the `.groups` argument.
"
"0","# replace NAs with zero"
"0","# 138 tiles"
"0",""
"0","# Make a long version"
"0","coral.divots_2016.long <- coral.divots_2016 %>%"
"0","  pivot_longer(-c(Year:New.Tile.Number,Pair),"
"0","               names_to = ""Tile.placement"", "
"0","               values_to = ""Corals"")"
"0",""
"0","unique(coral_2014.2016_clean$Substrate..Flat..edge..divot.) # lets ignore the corals on the plate, now there is a new placement called ""flat/edge"" that has a lot of corals"
"1","[1]"
"1"," NA         "
"1"," ""flat""     "
"1"," ""divot""    "
"1"," ""edge""     "
"1"," ""divot ""   "
"1"," ""plate""    "
"1","
"
"1","[7]"
"1"," ""flat/edge"""
"1"," ""edge/flat"""
"1","
"
"0","# small vs large divots"
"0","coral_2016.divot.size <- coral_2014.2016_clean_metadata %>%"
"0","  filter(Year == ""2016"") %>%"
"0","    mutate(Substrate..Flat..edge..divot.= "
"0","           dplyr::recode(Substrate..Flat..edge..divot., ""divot "" = ""divot"", "
"0","                  .default = Substrate..Flat..edge..divot.)) %>% "
"0","        mutate(Substrate..Flat..edge..divot.= "
"0","           dplyr::recode(Substrate..Flat..edge..divot., ""edge/flat"" = ""flat/edge"", "
"0","                  .default = Substrate..Flat..edge..divot.)) %>% "
"0","  # fix naming issue"
"0","    mutate(Convert = ifelse(Polyp.. %in% NA, NA, ""1"")) %>%"
"0","  # convert all the numbers to 1 so you can sum them"
"0","  mutate(Divot.Size = ifelse(divot.. %in% c(10,11), ""Large.divot"", "
"0","                             ifelse(divot.. %in% c(1:9), ""Small.divot"","
"0","                                    ifelse(Substrate..Flat..edge..divot. %in% ""flat"", ""Flat"","
"0","                                           ifelse(Substrate..Flat..edge..divot. %in% ""flat/edge"", ""Edge"", ifelse(Substrate..Flat..edge..divot. %in% ""edge"", ""Edge"", NA)))))) %>%"
"0","  # making all the flat/edge == edge"
"0","  # new column with divot size"
"0","  group_by(Year, Location, Depth, Treatment, "
"0","           Tile.number, Original.Tile.Number,Pair, New.Tile.Number, "
"0","           Divot.Size) %>%"
"0","  dplyr::summarize(Corals = sum(!is.na(Convert))) %>% "
"0","  # count up all the corals in divot vs flat, etc"
"0","  arrange(as.numeric(New.Tile.Number)) %>%"
"0","  ungroup() %>%"
"0","   pivot_wider(names_from = Divot.Size, "
"0","               values_from = Corals) %>% "
"0","  # wide so you can get zeros for the not counted"
"0","   dplyr::select(-""NA"") %>% "
"0","  # get rid of the NA column"
"0","   mutate_all(funs(replace_na(.,0))) "
"1","`summarise()` has grouped output by 'Year', 'Location', 'Depth', 'Treatment', 'Tile.number', 'Original.Tile.Number', 'Pair', 'New.Tile.Number'. You can override using the `.groups` argument.
"
"0","# replace NAs with zero"
"0","# 138 tiles again"
"0",""
"0","# Make a long version"
"0","coral_2016.divot.size.long <- coral_2016.divot.size  %>%"
"0","  pivot_longer(-c(Year:New.Tile.Number,Pair),"
"0","               names_to = ""Tile.placement"", "
"0","               values_to = ""Corals"")"
"0",""
"0",""
"0","# Make one full coral DF with all the data "
"0","coral.2016_wide <- coral.divots_2016 %>% "
"0","   dplyr::select(New.Tile.Number:""flat/edge"") %>% # corals per tile placement"
"0","   inner_join(coral.2016, by=""New.Tile.Number"") %>% # this has all.corals summed"
"0","  inner_join(coral_2016.divot.size[c(""New.Tile.Number"",""Small.divot"", ""Large.divot"")], "
"0","             by=""New.Tile.Number"") %>% # only take large and small divot because the other dfs already have the other info"
"0","  relocate(flat, .after = ""Large.divot"")%>%"
"0","  relocate(divot, .after = ""All.corals"")%>%"
"0","  relocate(edge, .after = ""Large.divot"") %>%"
"0","  relocate(""flat/edge"", .after = ""Large.divot"") %>%"
"0","  relocate(Tile.number:Original.Tile.Number, .after = New.Tile.Number) %>%"
"0","  # change positions to make it easier to read"
"0","  dplyr::rename(Flat.surface = flat) %>%"
"0","  dplyr::rename(All.divots = divot) %>%"
"0","  dplyr::rename(Edge = edge) %>%"
"0","  dplyr::rename(Flat.Edge = ""flat/edge"") %>%"
"0","  mutate(Treatment = ifelse(Treatment %in% ""caged"", ""Caged"", ""Uncaged"")) %>%"
"0","  mutate(Edge.final = Edge + Flat.Edge) %>%"
"0","  dplyr::select(-""plate"") # get rid of any corals on the baseplate"
"0","# 138 tiles"
"0",""
"0","# Long Version"
"0","coral.2016_long <- coral.2016_wide %>%"
"0","  pivot_longer(-c(Pair,New.Tile.Number:Treatment, All.corals, All.divots),"
"0","               names_to= ""Tile.Placement"", values_to= ""Corals"") %>%"
"0","  dplyr::select(-All.corals, -All.divots)"
"0",""
"0",""
"0",""
"0","# Long dataset with all divots vs flat surface (no small vs large and no edge)"
"0","coral.2016.divot.flat_long <- coral.2016_wide %>%"
"0","  pivot_longer(-c(New.Tile.Number:All.corals, Small.divot:Edge),"
"0","               names_to= ""Tile.Placement"", values_to= ""Corals"") %>%"
"0","  select(-All.corals, -Small.divot, -Large.divot, -Edge)"
"0",""
